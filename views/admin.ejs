<%- contentFor('content') %>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    .admin-container {
        max-width: 1400px;
        margin: 30px auto;
        padding: 20px;
        font-family: 'Rajdhani', sans-serif;
    }
    
    .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .admin-header h1 {
        margin: 0;
        color: #fff;
        font-family: 'Orbitron', sans-serif;
        font-weight: 900;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 2px solid #444;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
    }
    
    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #888;
        font-size: 0.85em;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .stat-card .stat-value {
        font-size: 2.2em;
        font-weight: 700;
        color: #fff;
        font-family: 'Orbitron', sans-serif;
    }
    
    .stat-card.players .stat-value { color: #3498db; }
    .stat-card.rooms .stat-value { color: #2ecc71; }
    .stat-card.playing .stat-value { color: #e67e22; }
    .stat-card.banned .stat-value { color: #e74c3c; }
    .stat-card.games .stat-value { color: #9b59b6; }
    
    .panel {
        background: linear-gradient(135deg, #151515 0%, #222 100%);
        border: 3px solid #444;
        border-radius: 18px;
        padding: 24px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.7);
    }
    
    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #333;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .panel-header h2 {
        margin: 0;
        color: #fff;
        font-family: 'Orbitron', sans-serif;
        font-size: 1.4em;
    }
    
    .panel-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .btn-admin {
        padding: 8px 16px;
        border: 2px solid;
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        font-family: 'Rajdhani', sans-serif;
        font-weight: 600;
        font-size: 0.9em;
        transition: all 0.3s;
        background: transparent;
    }
    
    .btn-admin:hover {
        transform: translateY(-2px);
    }
    
    .btn-refresh {
        border-color: #3498db;
        color: #3498db;
    }
    .btn-refresh:hover {
        background: #3498db;
        color: #fff;
    }
    
    .btn-danger {
        border-color: #e74c3c;
        color: #e74c3c;
    }
    .btn-danger:hover {
        background: #e74c3c;
        color: #fff;
    }
    
    .btn-warning {
        border-color: #f39c12;
        color: #f39c12;
    }
    .btn-warning:hover {
        background: #f39c12;
        color: #fff;
    }
    
    .btn-success {
        border-color: #2ecc71;
        color: #2ecc71;
    }
    .btn-success:hover {
        background: #2ecc71;
        color: #fff;
    }
    
    .btn-primary {
        border-color: #9b59b6;
        color: #9b59b6;
    }
    .btn-primary:hover {
        background: #9b59b6;
        color: #fff;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    th, td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #333;
    }
    
    th {
        background: #1a1a1a;
        color: #888;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.8em;
        letter-spacing: 1px;
    }
    
    td {
        color: #ddd;
        font-size: 0.95em;
    }
    
    tr:hover td {
        background: rgba(255,255,255,0.05);
    }
    
    .player-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-block;
        vertical-align: middle;
        margin-right: 8px;
        border: 2px solid rgba(255,255,255,0.3);
    }
    
    .status-badge {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
    }
    
    .status-online { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid #2ecc71; }
    .status-offline { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }
    .status-waiting { background: rgba(52, 152, 219, 0.2); color: #3498db; border: 1px solid #3498db; }
    .status-playing { background: rgba(230, 126, 34, 0.2); color: #e67e22; border: 1px solid #e67e22; }
    .status-banned { background: rgba(231, 76, 60, 0.3); color: #ff6b6b; border: 1px solid #e74c3c; }
    
    .action-btn {
        padding: 5px 10px;
        border-radius: 5px;
        border: 1px solid;
        cursor: pointer;
        font-family: 'Rajdhani', sans-serif;
        font-weight: 600;
        font-size: 0.85em;
        transition: all 0.2s;
        margin: 2px;
    }
    
    .action-btn.ban { border-color: #e74c3c; color: #e74c3c; background: transparent; }
    .action-btn.ban:hover { background: #e74c3c; color: #fff; }
    .action-btn.unban { border-color: #2ecc71; color: #2ecc71; background: transparent; }
    .action-btn.unban:hover { background: #2ecc71; color: #fff; }
    .action-btn.kick { border-color: #f39c12; color: #f39c12; background: transparent; }
    .action-btn.kick:hover { background: #f39c12; color: #fff; }
    .action-btn.delete { border-color: #c0392b; color: #c0392b; background: transparent; }
    .action-btn.delete:hover { background: #c0392b; color: #fff; }
    .action-btn.edit { border-color: #3498db; color: #3498db; background: transparent; }
    .action-btn.edit:hover { background: #3498db; color: #fff; }
    .action-btn.view { border-color: #9b59b6; color: #9b59b6; background: transparent; }
    .action-btn.view:hover { background: #9b59b6; color: #fff; }
    .action-btn.close { border-color: #e74c3c; color: #e74c3c; background: transparent; }
    .action-btn.close:hover { background: #e74c3c; color: #fff; }
    .action-btn.unlock { border-color: #2ecc71; color: #2ecc71; background: transparent; }
    .action-btn.unlock:hover { background: #2ecc71; color: #fff; }
    .action-btn.reset { border-color: #f39c12; color: #f39c12; background: transparent; }
    .action-btn.reset:hover { background: #f39c12; color: #fff; }
    
    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .tab-btn {
        padding: 10px 20px;
        background: #333;
        border: 2px solid #444;
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        font-family: 'Rajdhani', sans-serif;
        font-weight: 600;
        transition: all 0.3s;
    }
    
    .tab-btn.active {
        background: #e74c3c;
        border-color: #c0392b;
    }
    
    .tab-btn:hover:not(.active) {
        background: #444;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .search-box {
        padding: 10px 15px;
        border: 2px solid #444;
        border-radius: 8px;
        background: #1a1a1a;
        color: #fff;
        font-family: 'Rajdhani', sans-serif;
        font-size: 1em;
        width: 200px;
    }
    
    .search-box:focus {
        outline: none;
        border-color: #e74c3c;
    }
    
    .empty-message {
        text-align: center;
        padding: 40px;
        color: #888;
    }
    
    .room-players {
        font-size: 0.85em;
        color: #888;
    }
    
    .room-players span {
        display: inline-block;
        margin: 2px;
        padding: 2px 8px;
        background: rgba(255,255,255,0.1);
        border-radius: 10px;
    }
    
    .last-seen {
        font-size: 0.85em;
        color: #666;
    }
    
    .broadcast-input {
        width: 100%;
        padding: 15px;
        border: 2px solid #444;
        border-radius: 8px;
        background: #1a1a1a;
        color: #fff;
        font-family: 'Rajdhani', sans-serif;
        font-size: 1.1em;
        margin-bottom: 15px;
        resize: vertical;
        min-height: 80px;
    }
    
    .broadcast-input:focus {
        outline: none;
        border-color: #9b59b6;
    }
    
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .quick-action-btn {
        padding: 20px;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 2px solid #444;
        border-radius: 12px;
        color: #fff;
        cursor: pointer;
        font-family: 'Rajdhani', sans-serif;
        font-weight: 600;
        font-size: 1em;
        transition: all 0.3s;
        text-align: center;
    }
    
    .quick-action-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    }
    
    .quick-action-btn .icon {
        font-size: 2em;
        display: block;
        margin-bottom: 10px;
    }
    
    .quick-action-btn.danger { border-color: #e74c3c; }
    .quick-action-btn.danger:hover { background: rgba(231, 76, 60, 0.2); }
    .quick-action-btn.warning { border-color: #f39c12; }
    .quick-action-btn.warning:hover { background: rgba(243, 156, 18, 0.2); }
    .quick-action-btn.success { border-color: #2ecc71; }
    .quick-action-btn.success:hover { background: rgba(46, 204, 113, 0.2); }
    .quick-action-btn.primary { border-color: #9b59b6; }
    .quick-action-btn.primary:hover { background: rgba(155, 89, 182, 0.2); }
</style>

<div class="admin-container">
    <div class="admin-header">
        <h1>üõ†Ô∏è Admin Dashboard</h1>
        <div>
            <a href="/" class="btn-admin btn-refresh" style="text-decoration: none;">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
            <a href="/admin/logout" class="btn-admin btn-danger" style="text-decoration: none; margin-left: 10px;">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="stats-grid">
        <div class="stat-card players">
            <h3>üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <div class="stat-value" id="totalPlayers">0</div>
        </div>
        <div class="stat-card rooms">
            <h3>üè† ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <div class="stat-value" id="totalRooms">0</div>
        </div>
        <div class="stat-card playing">
            <h3>üéÆ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</h3>
            <div class="stat-value" id="playingRooms">0</div>
        </div>
        <div class="stat-card banned">
            <h3>üö´ ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô</h3>
            <div class="stat-value" id="bannedPlayers">0</div>
        </div>
        <div class="stat-card games">
            <h3>üìä ‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h3>
            <div class="stat-value" id="totalGames">0</div>
        </div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="players">üë• ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
        <button class="tab-btn" data-tab="rooms">üè† ‡∏´‡πâ‡∏≠‡∏á</button>
        <button class="tab-btn" data-tab="banned">üö´ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô</button>
        <button class="tab-btn" data-tab="stats">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
        <button class="tab-btn" data-tab="logs">üìã Logs</button>
        <button class="tab-btn" data-tab="settings">üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°</button>
        <button class="tab-btn" data-tab="system">‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    
    <!-- Players Tab -->
    <div class="tab-content active" id="tab-players">
        <div class="panel">
            <div class="panel-header">
                <h2>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
                <div class="panel-actions">
                    <input type="text" class="search-box" id="searchPlayers" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
                    <button class="btn-admin btn-danger" onclick="deleteSelectedPlayers()" id="btnDeleteSelected" style="display: none;">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (<span id="selectedCount">0</span>)</button>
                    <button class="btn-admin btn-danger" onclick="deleteAllPlayers()">üí• ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="btn-admin btn-refresh" onclick="loadData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40px;"><input type="checkbox" id="selectAllPlayers" onclick="toggleSelectAll(this)"></th>
                            <th>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                            <th>Player ID</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="playersTable">
                        <tr><td colspan="6" class="empty-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Rooms Tab -->
    <div class="tab-content" id="tab-rooms">
        <div class="panel">
            <div class="panel-header">
                <h2>üè† ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á</h2>
                <div class="panel-actions">
                    <button class="btn-admin btn-warning" onclick="clearEmptyRooms()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</button>
                    <button class="btn-admin btn-danger" onclick="clearAllRooms()">üí• ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="btn-admin btn-refresh" onclick="loadData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</th>
                            <th>Room ID</th>
                            <th>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th>‡∏•‡πá‡∏≠‡∏Ñ</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="roomsTable">
                        <tr><td colspan="6" class="empty-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Banned Tab -->
    <div class="tab-content" id="tab-banned">
        <div class="panel">
            <div class="panel-header">
                <h2>üö´ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô</h2>
                <div class="panel-actions">
                    <button class="btn-admin btn-refresh" onclick="loadData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                            <th>Player ID</th>
                            <th>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
                            <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡πÅ‡∏ö‡∏ô‡πÇ‡∏î‡∏¢</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="bannedTable">
                        <tr><td colspan="7" class="empty-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Stats Tab -->
    <div class="tab-content" id="tab-stats">
        <div class="panel">
            <div class="panel-header">
                <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
                <div class="panel-actions">
                    <button class="btn-admin btn-primary" onclick="exportStats()">üì• Export CSV</button>
                    <button class="btn-admin btn-refresh" onclick="loadData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th>
                            <th>‡πÄ‡∏Å‡∏°</th>
                            <th>‡∏ä‡∏ô‡∏∞</th>
                            <th>‡πÅ‡∏û‡πâ</th>
                            <th>Win%</th>
                            <th>GM</th>
                            <th>‡∏ó‡∏£‡∏¢‡∏®</th>
                            <th>‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="statsTable">
                        <tr><td colspan="9" class="empty-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Logs Tab -->
    <div class="tab-content" id="tab-logs">
        <div class="panel">
            <div class="panel-header">
                <h2>üìã Server Activity Logs</h2>
                <div class="panel-actions">
                    <select id="logFilter" class="search-box" style="width: auto;">
                        <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="join">‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</option>
                        <option value="leave">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                        <option value="game">‡πÄ‡∏Å‡∏°</option>
                        <option value="admin">Admin</option>
                        <option value="system">‡∏£‡∏∞‡∏ö‡∏ö</option>
                        <option value="error">Error</option>
                    </select>
                    <button class="btn-admin btn-danger" onclick="clearLogs()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Logs</button>
                    <button class="btn-admin btn-success" onclick="exportLogs()">üì• Export</button>
                </div>
            </div>
            <div id="logsContainer" style="max-height: 500px; overflow-y: auto; background: #0a0a0a; border-radius: 8px; padding: 15px; font-family: 'Consolas', monospace; font-size: 0.85em;">
                <div class="empty-message">Logs ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...</div>
            </div>
        </div>
    </div>
    
    <!-- Game Settings Tab -->
    <div class="tab-content" id="tab-settings">
        <div class="panel">
            <div class="panel-header">
                <h2>üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h2>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="setting-group">
                    <label style="color: #888; display: block; margin-bottom: 8px;">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                    <input type="number" id="defaultTimer" class="search-box" style="width: 100%;" value="5" min="1" max="30">
                </div>
                <div class="setting-group">
                    <label style="color: #888; display: block; margin-bottom: 8px;">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</label>
                    <input type="number" id="minPlayers" class="search-box" style="width: 100%;" value="4" min="3" max="10">
                </div>
                <div class="setting-group">
                    <label style="color: #888; display: block; margin-bottom: 8px;">üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                    <input type="number" id="maxPlayers" class="search-box" style="width: 100%;" value="8" min="4" max="20">
                </div>
                <div class="setting-group">
                    <label style="color: #888; display: block; margin-bottom: 8px;">üìÇ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥</label>
                    <select id="wordCategory" class="search-box" style="width: 100%;">
                        <option value="famille">‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß (famille.csv)</option>
                        <option value="random">‡∏™‡∏∏‡πà‡∏°</option>
                    </select>
                </div>
            </div>
            <button class="btn-admin btn-success" onclick="saveGameSettings()" style="width: 100%; margin-top: 20px; padding: 15px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>
        
        <div class="panel">
            <div class="panel-header">
                <h2>üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</h2>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="color: #888; display: block; margin-bottom: 8px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</label>
                <textarea id="newWords" class="broadcast-input" placeholder="‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà 1, ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà 2, ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà 3..."></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn-admin btn-success" onclick="addWords()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥</button>
                <button class="btn-admin btn-primary" onclick="viewWords()">üëÅÔ∏è ‡∏î‡∏π‡∏Ñ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-header">
                <h2>üõ°Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h2>
            </div>
            <div style="display: grid; gap: 15px;">
                <label style="color: #fff; display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="enableBanSystem" checked style="width: 20px; height: 20px;">
                    üö´ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ô
                </label>
                <label style="color: #fff; display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="enableProfanityFilter" style="width: 20px; height: 20px;">
                    ü§¨ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏´‡∏¢‡∏≤‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                </label>
                <label style="color: #fff; display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="requireApproval" style="width: 20px; height: 20px;">
                    ‚úÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </label>
            </div>
        </div>
    </div>
    
    <!-- System Tab -->
    <div class="tab-content" id="tab-system">
        <div class="panel">
            <div class="panel-header">
                <h2>üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® (Broadcast)</h2>
            </div>
            <textarea class="broadcast-input" id="broadcastMessage" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô..."></textarea>
            <button class="btn-admin btn-primary" onclick="sendBroadcast()" style="width: 100%; padding: 15px; font-size: 1.1em;">üì¢ ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
        </div>
        
        <div class="panel">
            <div class="panel-header">
                <h2>‚ö° Quick Actions</h2>
            </div>
            <div class="quick-actions">
                <button class="quick-action-btn warning" onclick="clearEmptyRooms()">
                    <span class="icon">üßπ</span>
                    ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
                </button>
                <button class="quick-action-btn danger" onclick="clearAllRooms()">
                    <span class="icon">üí•</span>
                    ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button class="quick-action-btn success" onclick="exportAllData()">
                    <span class="icon">üì•</span>
                    Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button class="quick-action-btn primary" onclick="loadData()">
                    <span class="icon">üîÑ</span>
                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-header">
                <h2>‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
            </div>
            <div style="color: #aaa; line-height: 2;">
                <p>üì¶ <strong>Version:</strong> 1.0.0</p>
                <p>üñ•Ô∏è <strong>Server:</strong> Node.js + Express + Socket.IO</p>
                <p>üíæ <strong>Data Storage:</strong> JSON Files (players.json, playerStats.json, bannedPlayers.json)</p>
                <p>üïê <strong>Server Time:</strong> <span id="serverTime">-</span></p>
                <p>‚è±Ô∏è <strong>Uptime:</strong> <span id="uptime">-</span></p>
            </div>
        </div>
    </div>
</div>

<%- contentFor('script') %>
<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
$(function() {
    const socket = io();
    let allData = {};
    let isAuthenticated = false;
    
    // Admin token ‡∏à‡∏≤‡∏Å server (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    const adminToken = '<%= adminToken %>';
    
    // Authenticate socket ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    socket.emit('admin_authenticate', { token: adminToken }, function(response) {
        if (response.success) {
            console.log('[Admin] Socket authenticated successfully');
            isAuthenticated = true;
            loadData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á authenticate ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            loadLogs(); // ‡πÇ‡∏´‡∏•‡∏î logs ‡∏î‡πâ‡∏ß‡∏¢
        } else {
            console.error('[Admin] Authentication failed:', response.error);
            Swal.fire({
                icon: 'error',
                title: 'Authentication Failed',
                text: response.error || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ login ‡πÉ‡∏´‡∏°‡πà',
                confirmButtonText: 'Login ‡πÉ‡∏´‡∏°‡πà'
            }).then(() => {
                window.location.href = '/admin/login';
            });
        }
    });
    
    // Tab switching
    $('.tab-btn').on('click', function() {
        const tab = $(this).data('tab');
        $('.tab-btn').removeClass('active');
        $(this).addClass('active');
        $('.tab-content').removeClass('active');
        $('#tab-' + tab).addClass('active');
    });
    
    // Search players
    $('#searchPlayers').on('input', function() {
        const search = $(this).val().toLowerCase();
        $('#playersTable tr').each(function() {
            const text = $(this).text().toLowerCase();
            $(this).toggle(text.includes(search));
        });
    });
    
    // Load data from server
    window.loadData = function() {
        if (!isAuthenticated) {
            console.warn('[Admin] Not authenticated, skipping loadData');
            return;
        }
        socket.emit('admin_getData', function(response) {
            if (response.success) {
                allData = response;
                updateStats(response);
                updatePlayersTable(response.players, response.bannedPlayers);
                updateRoomsTable(response.rooms);
                updateBannedTable(response.bannedPlayers);
                updateStatsTable(response.playerStats);
            } else if (response.error === 'Unauthorized - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ login ‡∏Å‡πà‡∏≠‡∏ô') {
                // Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ authenticate
                Swal.fire({
                    icon: 'warning',
                    title: 'Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ login ‡πÉ‡∏´‡∏°‡πà',
                    confirmButtonText: 'Login'
                }).then(() => {
                    window.location.href = '/admin/login';
                });
            }
        });
    };
    
    function updateStats(data) {
        $('#totalPlayers').text(data.players.length);
        $('#totalRooms').text(data.rooms.length);
        $('#playingRooms').text(data.rooms.filter(r => r.gameStatus === 'playing').length);
        $('#bannedPlayers').text(data.bannedPlayers ? data.bannedPlayers.length : 0);
        const totalGames = data.playerStats.reduce((sum, p) => sum + (p.totalGames || 0), 0) / 2;
        $('#totalGames').text(Math.floor(totalGames));
        $('#serverTime').text(new Date().toLocaleString('th-TH'));
    }
    
    function updatePlayersTable(players, bannedPlayers) {
        const $table = $('#playersTable');
        $table.empty();
        
        if (players.length === 0) {
            $table.html('<tr><td colspan="6" class="empty-message">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</td></tr>');
            return;
        }
        
        const bannedIds = (bannedPlayers || []).map(b => b.playerId);
        players.sort((a, b) => new Date(b.lastSeen) - new Date(a.lastSeen));
        
        players.forEach(function(player) {
            const lastSeen = new Date(player.lastSeen).toLocaleString('th-TH');
            const isRecent = (Date.now() - new Date(player.lastSeen)) < 5 * 60 * 1000;
            const isBanned = bannedIds.includes(player.playerId);
            
            const statusBadge = isBanned 
                ? '<span class="status-badge status-banned">‡πÅ‡∏ö‡∏ô</span>'
                : (isRecent ? '<span class="status-badge status-online">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>' : '<span class="status-badge status-offline">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>');
            
            const actions = isBanned 
                ? `<button class="action-btn unban" onclick="unbanPlayer('${player.playerId}')">‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô</button>`
                : `<button class="action-btn ban" onclick="banPlayer('${player.playerId}', '${escapeHtml(player.playerName)}')">‡πÅ‡∏ö‡∏ô</button>`;
            
            const row = `
                <tr data-player-id="${player.playerId}">
                    <td><input type="checkbox" class="player-checkbox" data-player-id="${player.playerId}" data-player-name="${escapeHtml(player.playerName)}" onclick="updateSelectedCount()"></td>
                    <td>
                        <span class="player-color" style="background: ${player.color}"></span>
                        ${escapeHtml(player.playerName)}
                    </td>
                    <td><code style="font-size: 0.8em; color: #888;">${player.playerId.substring(0, 8)}...</code></td>
                    <td>${statusBadge}</td>
                    <td class="last-seen">${lastSeen}</td>
                    <td>
                        ${actions}
                        <button class="action-btn edit" onclick="editPlayerName('${player.playerId}', '${escapeHtml(player.playerName)}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="action-btn delete" onclick="deletePlayer('${player.playerId}', '${escapeHtml(player.playerName)}')">‡∏•‡∏ö</button>
                    </td>
                </tr>
            `;
            $table.append(row);
        });
        
        // Reset select all checkbox
        $('#selectAllPlayers').prop('checked', false);
        updateSelectedCount();
    }
    
    function updateRoomsTable(rooms) {
        const $table = $('#roomsTable');
        $table.empty();
        
        if (rooms.length === 0) {
            $table.html('<tr><td colspan="6" class="empty-message">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á</td></tr>');
            return;
        }
        
        rooms.forEach(function(room) {
            const statusClass = room.gameStatus === 'playing' ? 'status-playing' : 'status-waiting';
            const statusText = room.gameStatus === 'playing' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô' : '‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô';
            const gamePhase = room.gamePhase || '-';
            
            const row = `
                <tr>
                    <td>${escapeHtml(room.name)}</td>
                    <td><code style="font-size: 0.85em; color: #888;">${room.roomId}</code></td>
                    <td>${room.playerCount} / ${room.maxPlayers}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${room.locked ? 'üîí' : 'üîì'}</td>
                    <td>
                        <button class="action-btn view" onclick="viewRoomDetails('${room.roomId}', '${escapeHtml(room.name)}')">üëÅÔ∏è ‡∏î‡∏π</button>
                        ${room.locked ? `<button class="action-btn unlock" onclick="unlockRoom('${room.roomId}')">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ</button>` : ''}
                        <button class="action-btn reset" onclick="resetRoom('${room.roomId}')">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                        <button class="action-btn close" onclick="closeRoom('${room.roomId}', '${escapeHtml(room.name)}')">‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á</button>
                    </td>
                </tr>
            `;
            $table.append(row);
        });
    }
    
    function updateBannedTable(bannedPlayers) {
        const $table = $('#bannedTable');
        $table.empty();
        
        if (!bannedPlayers || bannedPlayers.length === 0) {
            $table.html('<tr><td colspan="7" class="empty-message">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô</td></tr>');
            return;
        }
        
        bannedPlayers.forEach(function(ban) {
            const bannedAt = new Date(ban.bannedAt).toLocaleString('th-TH');
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
            let durationText = '';
            let remainingText = '';
            
            if (ban.isPermanent || !ban.expiresAt) {
                durationText = '<span style="color: #e74c3c;">‡∏ñ‡∏≤‡∏ß‡∏£ ‚ôæÔ∏è</span>';
                remainingText = '<span style="color: #e74c3c;">-</span>';
            } else {
                const expiresAt = new Date(ban.expiresAt);
                const now = new Date();
                const remainingMs = expiresAt - now;
                
                if (remainingMs <= 0) {
                    durationText = `${ban.durationHours} ‡∏ä‡∏°.`;
                    remainingText = '<span style="color: #2ecc71;">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß</span>';
                } else {
                    const hours = Math.floor(remainingMs / (1000 * 60 * 60));
                    const minutes = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
                    durationText = `${ban.durationHours} ‡∏ä‡∏°.`;
                    remainingText = hours > 0 ? `${hours} ‡∏ä‡∏°. ${minutes} ‡∏ô.` : `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
                }
            }
            
            const row = `
                <tr>
                    <td>${escapeHtml(ban.playerName)}</td>
                    <td><code style="font-size: 0.8em; color: #888;">${ban.playerId.substring(0, 8)}...</code></td>
                    <td>${escapeHtml(ban.reason)}</td>
                    <td>${durationText}</td>
                    <td style="color: #f39c12;">${remainingText}</td>
                    <td>${escapeHtml(ban.bannedBy)}</td>
                    <td>
                        <button class="action-btn unban" onclick="unbanPlayer('${ban.playerId}')">‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô</button>
                    </td>
                </tr>
            `;
            $table.append(row);
        });
    }
    
    function updateStatsTable(stats) {
        const $table = $('#statsTable');
        $table.empty();
        
        if (stats.length === 0) {
            $table.html('<tr><td colspan="9" class="empty-message">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</td></tr>');
            return;
        }
        
        stats.sort((a, b) => (b.totalGames || 0) - (a.totalGames || 0));
        
        stats.forEach(function(stat) {
            const winRate = stat.totalGames > 0 ? Math.round((stat.wins / stat.totalGames) * 100) : 0;
            const row = `
                <tr>
                    <td>${escapeHtml(stat.playerName || 'Unknown')}</td>
                    <td>${stat.totalGames || 0}</td>
                    <td style="color: #2ecc71;">${stat.wins || 0}</td>
                    <td style="color: #e74c3c;">${stat.losses || 0}</td>
                    <td style="color: ${winRate >= 50 ? '#2ecc71' : '#e74c3c'};">${winRate}%</td>
                    <td>${stat.roleStats?.gameMasterCount || 0}</td>
                    <td>${stat.roleStats?.traitorCount || 0}</td>
                    <td>${stat.roleStats?.citizenCount || 0}</td>
                    <td>
                        <button class="action-btn reset" onclick="resetPlayerStats('${stat.playerId}', '${escapeHtml(stat.playerName)}')">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                    </td>
                </tr>
            `;
            $table.append(row);
        });
    }
    
    // ========== Admin Actions ==========
    
    window.banPlayer = function(playerId, playerName) {
        Swal.fire({
            title: 'üö´ ‡πÅ‡∏ö‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô',
            html: `
                <p>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô <strong>${playerName}</strong>?</p>
                <div style="text-align: left; margin-top: 20px;">
                    <label style="display: block; margin-bottom: 5px; color: #888;">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô:</label>
                    <input type="text" id="banReason" class="swal2-input" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..." style="margin: 0 0 15px 0; width: 100%; box-sizing: border-box;">
                    
                    <label style="display: block; margin-bottom: 5px; color: #888;">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ô:</label>
                    <select id="banDuration" class="swal2-select" style="width: 100%; padding: 10px; border-radius: 5px; background: #1a1a1a; color: #fff; border: 1px solid #444;">
                        <option value="1">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                        <option value="6">6 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                        <option value="24">1 ‡∏ß‡∏±‡∏ô (24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</option>
                        <option value="72">3 ‡∏ß‡∏±‡∏ô</option>
                        <option value="168">7 ‡∏ß‡∏±‡∏ô (1 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
                        <option value="720">30 ‡∏ß‡∏±‡∏ô (1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</option>
                        <option value="0">‡∏ñ‡∏≤‡∏ß‡∏£ ‚ôæÔ∏è</option>
                    </select>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'üö´ ‡πÅ‡∏ö‡∏ô',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff',
            preConfirm: () => {
                return {
                    reason: document.getElementById('banReason').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•',
                    duration: parseInt(document.getElementById('banDuration').value)
                };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const { reason, duration } = result.value;
                socket.emit('admin_banPlayer', { 
                    playerId, 
                    reason,
                    durationHours: duration === 0 ? null : duration // null = ‡∏ñ‡∏≤‡∏ß‡∏£
                }, function(res) {
                    if (res.success) {
                        const durationText = duration === 0 ? '‡∏ñ‡∏≤‡∏ß‡∏£' : `${duration} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
                        Swal.fire({ 
                            icon: 'success', 
                            title: '‡πÅ‡∏ö‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 
                            html: `‡πÅ‡∏ö‡∏ô <strong>${playerName}</strong><br>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${durationText}`,
                            timer: 2000, 
                            showConfirmButton: false, 
                            background: '#1e1e1e', 
                            color: '#fff' 
                        });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.unbanPlayer = function(playerId) {
        socket.emit('admin_unbanPlayer', { playerId }, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: '‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                loadData();
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    window.editPlayerName = function(playerId, currentName) {
        Swal.fire({
            title: '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠',
            input: 'text',
            inputValue: currentName,
            showCancelButton: true,
            confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed && result.value) {
                socket.emit('admin_editPlayerName', { playerId, newName: result.value }, function(res) {
                    if (res.success) {
                        Swal.fire({ icon: 'success', title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.deletePlayer = function(playerId, playerName) {
        Swal.fire({
            title: 'üóëÔ∏è ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô',
            html: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö <strong>${playerName}</strong>?<br><small style="color:#e74c3c;">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!</small>`,
            showCancelButton: true,
            confirmButtonText: '‡∏•‡∏ö',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_deletePlayer', { playerId }, function(res) {
                    if (res.success) {
                        Swal.fire({ icon: 'success', title: '‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.closeRoom = function(roomId, roomName) {
        Swal.fire({
            title: '‚ùå ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á',
            html: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á <strong>${roomName}</strong>?<br><small>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏∞‡∏≠‡∏≠‡∏Å</small>`,
            showCancelButton: true,
            confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_closeRoom', { roomId }, function(res) {
                    if (res.success) {
                        Swal.fire({ icon: 'success', title: '‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.unlockRoom = function(roomId) {
        socket.emit('admin_unlockRoom', { roomId }, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: '‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                loadData();
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    window.resetRoom = function(roomId) {
        socket.emit('admin_resetRoom', { roomId }, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                loadData();
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    window.resetPlayerStats = function(playerId, playerName) {
        Swal.fire({
            title: 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥',
            html: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á <strong>${playerName}</strong>?`,
            showCancelButton: true,
            confirmButtonText: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#f39c12',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_resetPlayerStats', { playerId }, function(res) {
                    if (res.success) {
                        Swal.fire({ icon: 'success', title: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.clearEmptyRooms = function() {
        socket.emit('admin_clearEmptyRooms', function(res) {
            Swal.fire({ icon: 'success', title: `‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ${res.count} ‡∏´‡πâ‡∏≠‡∏á`, timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
            loadData();
        });
    };
    
    window.clearAllRooms = function() {
        Swal.fire({
            title: 'üí• ‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
            html: '<span style="color:#e74c3c;">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!</span>',
            showCancelButton: true,
            confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_clearAllRooms', function(res) {
                    Swal.fire({ icon: 'success', title: `‡∏•‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${res.count} ‡∏´‡πâ‡∏≠‡∏á`, timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                    loadData();
                });
            }
        });
    };
    
    window.sendBroadcast = function() {
        const message = $('#broadcastMessage').val().trim();
        if (!message) {
            Swal.fire({ icon: 'warning', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', background: '#1e1e1e', color: '#fff' });
            return;
        }
        
        socket.emit('admin_broadcast', { message }, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: '‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                $('#broadcastMessage').val('');
            }
        });
    };
    
    window.exportStats = function() {
        if (!allData.playerStats) return;
        
        let csv = 'Player Name,Total Games,Wins,Losses,Win Rate,GM Count,Traitor Count,Citizen Count\n';
        allData.playerStats.forEach(s => {
            const winRate = s.totalGames > 0 ? Math.round((s.wins / s.totalGames) * 100) : 0;
            csv += `"${s.playerName}",${s.totalGames || 0},${s.wins || 0},${s.losses || 0},${winRate}%,${s.roleStats?.gameMasterCount || 0},${s.roleStats?.traitorCount || 0},${s.roleStats?.citizenCount || 0}\n`;
        });
        
        downloadCSV(csv, 'player_stats.csv');
    };
    
    window.exportAllData = function() {
        const dataStr = JSON.stringify(allData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'insider_game_data_' + new Date().toISOString().slice(0,10) + '.json';
        a.click();
    };
    
    function downloadCSV(csv, filename) {
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
    }
    
    function escapeHtml(text) {
        if (!text) return '';
        const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
        return String(text).replace(/[&<>"']/g, m => map[m]);
    }
    
    // ========== Bulk Selection Functions ==========
    
    window.toggleSelectAll = function(checkbox) {
        $('.player-checkbox').prop('checked', checkbox.checked);
        updateSelectedCount();
    };
    
    window.updateSelectedCount = function() {
        const selectedCount = $('.player-checkbox:checked').length;
        $('#selectedCount').text(selectedCount);
        
        if (selectedCount > 0) {
            $('#btnDeleteSelected').show();
        } else {
            $('#btnDeleteSelected').hide();
        }
    };
    
    window.deleteSelectedPlayers = function() {
        const selectedCheckboxes = $('.player-checkbox:checked');
        const count = selectedCheckboxes.length;
        
        if (count === 0) {
            Swal.fire({ icon: 'warning', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô', background: '#1e1e1e', color: '#fff' });
            return;
        }
        
        const playerIds = [];
        const playerNames = [];
        selectedCheckboxes.each(function() {
            playerIds.push($(this).data('player-id'));
            playerNames.push($(this).data('player-name'));
        });
        
        Swal.fire({
            title: 'üóëÔ∏è ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å',
            html: `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö <strong>${count}</strong> ‡∏Ñ‡∏ô?<br><br>
                   <div style="max-height: 150px; overflow-y: auto; text-align: left; background: #111; padding: 10px; border-radius: 8px; font-size: 0.9em;">
                   ${playerNames.map(n => `‚Ä¢ ${n}`).join('<br>')}
                   </div>
                   <br><small style="color:#e74c3c;">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!</small>`,
            showCancelButton: true,
            confirmButtonText: `‡∏•‡∏ö ${count} ‡∏Ñ‡∏ô`,
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_bulkDeletePlayers', { playerIds }, function(res) {
                    if (res.success) {
                        Swal.fire({ 
                            icon: 'success', 
                            title: `‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${res.deletedCount} ‡∏Ñ‡∏ô`, 
                            timer: 2000, 
                            showConfirmButton: false, 
                            background: '#1e1e1e', 
                            color: '#fff' 
                        });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.deleteAllPlayers = function() {
        const totalPlayers = $('#playersTable tr').length;
        
        Swal.fire({
            title: 'üí• ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
            html: `<span style="color:#e74c3c; font-size: 1.2em;">‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!</span><br><br>
                   ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong>${totalPlayers}</strong> ‡∏Ñ‡∏ô?<br><br>
                   <small style="color:#e74c3c;">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!<br>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ!</small>`,
            showCancelButton: true,
            confirmButtonText: 'üí• ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_deleteAllPlayers', {}, function(res) {
                    if (res.success) {
                        Swal.fire({ 
                            icon: 'success', 
                            title: `‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${res.deletedCount} ‡∏Ñ‡∏ô`, 
                            timer: 2000, 
                            showConfirmButton: false, 
                            background: '#1e1e1e', 
                            color: '#fff' 
                        });
                        loadData();
                    } else {
                        Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    // ========== Room Details ==========
    window.viewRoomDetails = function(roomId, roomName) {
        socket.emit('admin_getRoomDetails', { roomId }, function(res) {
            if (res.success) {
                const room = res.room;
                const playersHtml = room.players.length > 0 
                    ? room.players.map(p => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #222; border-radius: 6px; margin-bottom: 5px;">
                            <span>
                                <span style="display: inline-block; width: 12px; height: 12px; background: ${p.color}; border-radius: 50%; margin-right: 8px;"></span>
                                ${escapeHtml(p.name)}
                                ${p.isAdmin ? ' üëë' : ''}
                                ${p.role ? ` <small style="color: #888;">(${p.role})</small>` : ''}
                            </span>
                            <button class="action-btn kick" onclick="kickPlayerFromRoom('${roomId}', '${p.id}', '${escapeHtml(p.name)}')">‡πÄ‡∏ï‡∏∞</button>
                        </div>
                    `).join('') 
                    : '<div style="color: #888; text-align: center;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>';
                
                Swal.fire({
                    title: `üè† ${roomName}`,
                    html: `
                        <div style="text-align: left; color: #ddd;">
                            <p><strong>Room ID:</strong> <code>${roomId}</code></p>
                            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${room.gameStatus === 'playing' ? 'üéÆ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô' : '‚è≥ ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô'}</p>
                            <p><strong>Phase:</strong> ${room.gamePhase || '-'}</p>
                            <p><strong>‡∏•‡πá‡∏≠‡∏Ñ:</strong> ${room.locked ? 'üîí ‡∏•‡πá‡∏≠‡∏Ñ' : 'üîì ‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Ñ'}</p>
                            <p><strong>‡∏Ñ‡∏≥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> ${room.currentWord || '-'}</p>
                            <hr style="border-color: #444; margin: 15px 0;">
                            <p><strong>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (${room.players.length}/${room.maxPlayers}):</strong></p>
                            <div style="max-height: 200px; overflow-y: auto;">
                                ${playersHtml}
                            </div>
                        </div>
                    `,
                    width: 500,
                    background: '#1e1e1e',
                    color: '#fff',
                    showConfirmButton: true,
                    confirmButtonText: '‡∏õ‡∏¥‡∏î'
                });
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    window.kickPlayerFromRoom = function(roomId, playerId, playerName) {
        socket.emit('admin_kickPlayerFromRoom', { roomId, playerId }, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: `‡πÄ‡∏ï‡∏∞ ${playerName} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                // Refresh room details
                Swal.close();
                loadData();
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    // ========== Logs Functions ==========
    let serverLogs = [];
    
    // Load existing logs from server
    function loadLogs() {
        const filter = $('#logFilter').val();
        socket.emit('admin_getLogs', { filter: filter, limit: 200 }, function(response) {
            if (response.success) {
                serverLogs = response.logs || [];
                renderLogs();
            }
        });
    }
    
    // Receive new log entries in real-time
    socket.on('adminLog', function(logEntry) {
        serverLogs.unshift(logEntry);
        if (serverLogs.length > 500) serverLogs.length = 500;
        renderLogs();
    });
    
    function renderLogs() {
        const filter = $('#logFilter').val();
        const filtered = filter === 'all' ? serverLogs : serverLogs.filter(l => l.category === filter);
        
        const $container = $('#logsContainer');
        if (filtered.length === 0) {
            $container.html('<div class="empty-message">‡πÑ‡∏°‡πà‡∏°‡∏µ Logs</div>');
            return;
        }
        
        const colors = {
            'join': '#2ecc71',
            'leave': '#e74c3c', 
            'game': '#3498db',
            'admin': '#9b59b6',
            'error': '#ff6b6b',
            'chat': '#f39c12',
            'system': '#95a5a6'
        };
        const typeColors = {
            'info': '#3498db',
            'success': '#2ecc71',
            'warning': '#f39c12',
            'error': '#e74c3c'
        };
        const icons = {
            'join': '‚û°Ô∏è',
            'leave': '‚¨ÖÔ∏è',
            'game': 'üéÆ',
            'admin': 'üëë',
            'error': '‚ùå',
            'chat': 'üí¨',
            'system': '‚öôÔ∏è'
        };
        
        $container.html(filtered.map(log => {
            const time = new Date(log.timestamp).toLocaleTimeString('th-TH');
            const color = typeColors[log.type] || colors[log.category] || '#fff';
            const icon = icons[log.category] || '‚Ä¢';
            const roomInfo = log.roomName ? `<span style="color: #888;">[${log.roomName}]</span> ` : '';
            return `<div style="margin-bottom: 6px; padding: 4px 8px; border-left: 3px solid ${color}; background: rgba(255,255,255,0.03);">
                <span style="color: #666;">[${time}]</span> ${icon} ${roomInfo}<span style="color: ${color};">${log.message}</span>
            </div>`;
        }).join(''));
        
        // Auto scroll to top (newest)
        $container.scrollTop(0);
    }
    
    $('#logFilter').on('change', function() {
        loadLogs();
    });
    
    window.clearLogs = function() {
        Swal.fire({
            title: 'üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Logs',
            text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á Logs ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?',
            showCancelButton: true,
            confirmButtonText: '‡∏•‡πâ‡∏≤‡∏á',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            confirmButtonColor: '#e74c3c',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                socket.emit('admin_clearLogs', function(response) {
                    if (response.success) {
                        serverLogs = [];
                        renderLogs();
                        Swal.fire({ icon: 'success', title: '‡∏•‡πâ‡∏≤‡∏á Logs ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1000, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                    }
                });
            }
        });
    };
    
    window.exportLogs = function() {
        if (serverLogs.length === 0) {
            Swal.fire({ icon: 'warning', title: '‡πÑ‡∏°‡πà‡∏°‡∏µ Logs', background: '#1e1e1e', color: '#fff' });
            return;
        }
        const logsText = serverLogs.map(l => {
            const time = new Date(l.timestamp).toLocaleString('th-TH');
            return `[${time}] [${l.category.toUpperCase()}] ${l.roomName ? '[' + l.roomName + '] ' : ''}${l.message}`;
        }).join('\n');
        const blob = new Blob([logsText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'server_logs_' + new Date().toISOString().slice(0,10) + '.txt';
        a.click();
    };
    
    // Load logs after authentication
    socket.on('connect', function() {
        if (isAuthenticated) {
            loadLogs();
        }
    });
    
    // ========== Settings Functions ==========
    window.saveGameSettings = function() {
        const settings = {
            defaultTimer: parseInt($('#defaultTimer').val()),
            minPlayers: parseInt($('#minPlayers').val()),
            maxPlayers: parseInt($('#maxPlayers').val()),
            wordCategory: $('#wordCategory').val()
        };
        
        socket.emit('admin_saveSettings', settings, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    window.addWords = function() {
        const wordsText = $('#newWords').val().trim();
        if (!wordsText) {
            Swal.fire({ icon: 'warning', title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°', background: '#1e1e1e', color: '#fff' });
            return;
        }
        
        const words = wordsText.split(',').map(w => w.trim()).filter(w => w);
        socket.emit('admin_addWords', { words }, function(res) {
            if (res.success) {
                Swal.fire({ icon: 'success', title: `‡πÄ‡∏û‡∏¥‡πà‡∏° ${res.addedCount} ‡∏Ñ‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, timer: 1500, showConfirmButton: false, background: '#1e1e1e', color: '#fff' });
                $('#newWords').val('');
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    window.viewWords = function() {
        socket.emit('admin_getWords', {}, function(res) {
            if (res.success) {
                Swal.fire({
                    title: 'üìù ‡∏Ñ‡∏≥‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                    html: `
                        <div style="max-height: 400px; overflow-y: auto; text-align: left; background: #111; padding: 15px; border-radius: 8px;">
                            <p style="color: #888; margin-bottom: 10px;">‡∏£‡∏ß‡∏° ${res.words.length} ‡∏Ñ‡∏≥</p>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${res.words.map(w => `<span style="background: #333; padding: 4px 10px; border-radius: 15px; font-size: 0.9em;">${escapeHtml(w)}</span>`).join('')}
                            </div>
                        </div>
                    `,
                    width: 600,
                    background: '#1e1e1e',
                    color: '#fff',
                    showConfirmButton: true,
                    confirmButtonText: '‡∏õ‡∏¥‡∏î'
                });
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: res.error, background: '#1e1e1e', color: '#fff' });
            }
        });
    };
    
    // Listen for real-time events
    socket.on('admin_log', function(data) {
        addLog(data.type, data.message);
    });
    
    // Load initial data
    loadData();
    
    // Auto refresh every 15 seconds
    setInterval(loadData, 15000);
    
    // Update server time every second
    setInterval(() => {
        $('#serverTime').text(new Date().toLocaleString('th-TH'));
    }, 1000);
});
</script>
