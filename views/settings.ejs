<%- contentFor('content') %>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    .settings-container {
        max-width: 800px;
        margin: 30px auto;
        padding: 20px;
        font-family: 'Rajdhani', sans-serif;
    }
    
    .settings-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .settings-header h1 {
        color: #fff;
        font-family: 'Orbitron', sans-serif;
        font-weight: 900;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        margin-bottom: 10px;
    }
    
    .settings-header p {
        color: #888;
        font-size: 1.1em;
    }
    
    .settings-section {
        background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
        border: 3px solid #444;
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    }
    
    .settings-section h2 {
        color: #fff;
        font-family: 'Orbitron', sans-serif;
        font-weight: 700;
        font-size: 1.3em;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 2px solid #444;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .settings-section h2 .icon {
        font-size: 1.2em;
    }
    
    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #333;
    }
    
    .setting-item:last-child {
        border-bottom: none;
    }
    
    .setting-info h3 {
        color: #fff;
        font-size: 1.1em;
        font-weight: 600;
        margin: 0 0 5px 0;
    }
    
    .setting-info p {
        color: #888;
        font-size: 0.9em;
        margin: 0;
    }
    
    /* Toggle Switch */
    .toggle-switch {
        position: relative;
        width: 60px;
        height: 32px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #444;
        border-radius: 32px;
        transition: all 0.3s;
    }
    
    .toggle-slider::before {
        content: '';
        position: absolute;
        height: 24px;
        width: 24px;
        left: 4px;
        bottom: 4px;
        background: #fff;
        border-radius: 50%;
        transition: all 0.3s;
    }
    
    .toggle-switch input:checked + .toggle-slider {
        background: #2ecc71;
    }
    
    .toggle-switch input:checked + .toggle-slider::before {
        transform: translateX(28px);
    }
    
    /* Volume Slider */
    .volume-control {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .volume-slider {
        -webkit-appearance: none;
        width: 150px;
        height: 8px;
        border-radius: 4px;
        background: #444;
        outline: none;
    }
    
    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #e74c3c;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .volume-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
    }
    
    .volume-value {
        color: #fff;
        font-weight: 600;
        min-width: 45px;
        text-align: center;
    }
    
    /* Select Dropdown */
    .setting-select {
        padding: 10px 15px;
        background: #333;
        border: 2px solid #444;
        border-radius: 8px;
        color: #fff;
        font-family: 'Rajdhani', sans-serif;
        font-size: 1em;
        cursor: pointer;
        min-width: 150px;
    }
    
    .setting-select:focus {
        outline: none;
        border-color: #e74c3c;
    }
    
    /* Buttons */
    .settings-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
    }
    
    .btn-settings {
        padding: 12px 30px;
        border: 2px solid;
        border-radius: 8px;
        font-family: 'Rajdhani', sans-serif;
        font-weight: 600;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-save {
        background: #2ecc71;
        border-color: #27ae60;
        color: #fff;
    }
    
    .btn-save:hover {
        background: #27ae60;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
    }
    
    .btn-reset {
        background: transparent;
        border-color: #888;
        color: #888;
    }
    
    .btn-reset:hover {
        border-color: #e74c3c;
        color: #e74c3c;
    }
    
    .btn-back {
        display: inline-block;
        padding: 12px 24px;
        background: #333;
        border: 2px solid #444;
        border-radius: 8px;
        color: #fff;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }
    
    .btn-back:hover {
        background: #444;
        color: #fff;
    }
    
    /* Info Box */
    .info-box {
        background: rgba(52, 152, 219, 0.1);
        border: 2px solid #3498db;
        border-radius: 10px;
        padding: 15px 20px;
        margin-top: 20px;
    }
    
    .info-box p {
        color: #3498db;
        margin: 0;
        font-size: 0.95em;
    }
    
    .info-box .icon {
        margin-right: 8px;
    }
    
    /* Version Info */
    .version-info {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #333;
    }
    
    .version-info p {
        color: #666;
        font-size: 0.9em;
        margin: 5px 0;
    }
    
    .version-info .version {
        color: #888;
        font-family: 'Orbitron', sans-serif;
    }
</style>

<div class="settings-container">
    <div class="settings-header">
        <h1>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h1>
        <p>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    </div>
    
    <!-- Sound Settings -->
    <div class="settings-section">
        <h2><span class="icon">üîä</span> ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h2>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
                <p>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="bgmToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á</h3>
                <p>‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</p>
            </div>
            <div class="volume-control">
                <input type="range" class="volume-slider" id="bgmVolume" min="0" max="100" value="50">
                <span class="volume-value" id="bgmVolumeValue">50%</span>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</h3>
                <p>‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏∏‡πà‡∏°</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="sfxToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</h3>
                <p>‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå</p>
            </div>
            <div class="volume-control">
                <input type="range" class="volume-slider" id="sfxVolume" min="0" max="100" value="70">
                <span class="volume-value" id="sfxVolumeValue">70%</span>
            </div>
        </div>
    </div>
    
    <!-- Notification Settings -->
    <div class="settings-section">
        <h2><span class="icon">üîî</span> ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏Å‡∏°</h3>
                <p>‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="notificationToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏ï‡∏≤</h3>
                <p>‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏ß‡∏ï</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="turnNotificationToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ä‡∏ó</h3>
                <p>‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="chatNotificationToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>
    
    <!-- Display Settings -->
    <div class="settings-section">
        <h2><span class="icon">üé®</span> ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</h2>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡∏ò‡∏µ‡∏°</h3>
                <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°</p>
            </div>
            <select class="setting-select" id="themeSelect">
                <option value="dark">‡∏°‡∏∑‡∏î (Dark)</option>
                <option value="light" disabled>‡∏™‡∏ß‡πà‡∏≤‡∏á (Light) - ‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</option>
                <option value="red" disabled>‡πÅ‡∏î‡∏á (Red) - ‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</option>
            </select>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô</h3>
                <p>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="animationToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>
    
    <!-- Game Settings -->
    <div class="settings-section">
        <h2><span class="icon">üéÆ</span> ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</h2>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</h3>
                <p>‡∏ñ‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="confirmLeaveToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h3>‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</h3>
                <p>‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏ì‡∏∞‡πÄ‡∏•‡πà‡∏ô</p>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="hintsToggle" checked>
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>
    
    <!-- Info Box -->
    <div class="info-box">
        <p><span class="icon">üí°</span> ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    </div>
    
    <!-- Actions -->
    <div class="settings-actions">
        <button class="btn-settings btn-reset" id="resetSettings">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
    </div>
    
    <!-- Version Info -->
    <div class="version-info">
        <p>Insider Game</p>
        <p class="version">Version 1.0.0</p>
    </div>
</div>

<%- contentFor('footer') %>
<div class="container" style="text-align: center; padding: 20px;">
    <a href="/?playerId=<%= player.playerId %>" class="btn-back">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Lobby</a>
</div>

<%- contentFor('script') %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
$(function() {
    // Load settings from localStorage
    function loadSettings() {
        const settings = JSON.parse(localStorage.getItem('gameSettings') || '{}');
        
        // Sound
        $('#bgmToggle').prop('checked', settings.bgmEnabled !== false);
        $('#bgmVolume').val(settings.bgmVolume || 50);
        $('#bgmVolumeValue').text((settings.bgmVolume || 50) + '%');
        $('#sfxToggle').prop('checked', settings.sfxEnabled !== false);
        $('#sfxVolume').val(settings.sfxVolume || 70);
        $('#sfxVolumeValue').text((settings.sfxVolume || 70) + '%');
        
        // Notifications
        $('#notificationToggle').prop('checked', settings.notificationsEnabled !== false);
        $('#turnNotificationToggle').prop('checked', settings.turnNotificationEnabled !== false);
        $('#chatNotificationToggle').prop('checked', settings.chatNotificationEnabled !== false);
        
        // Display
        $('#themeSelect').val(settings.theme || 'dark');
        $('#animationToggle').prop('checked', settings.animationsEnabled !== false);
        
        // Game
        $('#confirmLeaveToggle').prop('checked', settings.confirmLeave !== false);
        $('#hintsToggle').prop('checked', settings.hintsEnabled !== false);
        
        // Apply BGM setting
        const audio = document.getElementById('background-music');
        if (audio) {
            audio.muted = !$('#bgmToggle').is(':checked');
            audio.volume = ($('#bgmVolume').val() / 100);
        }
    }
    
    // Save settings to localStorage
    function saveSettings() {
        const settings = {
            bgmEnabled: $('#bgmToggle').is(':checked'),
            bgmVolume: parseInt($('#bgmVolume').val()),
            sfxEnabled: $('#sfxToggle').is(':checked'),
            sfxVolume: parseInt($('#sfxVolume').val()),
            notificationsEnabled: $('#notificationToggle').is(':checked'),
            turnNotificationEnabled: $('#turnNotificationToggle').is(':checked'),
            chatNotificationEnabled: $('#chatNotificationToggle').is(':checked'),
            theme: $('#themeSelect').val(),
            animationsEnabled: $('#animationToggle').is(':checked'),
            confirmLeave: $('#confirmLeaveToggle').is(':checked'),
            hintsEnabled: $('#hintsToggle').is(':checked')
        };
        
        localStorage.setItem('gameSettings', JSON.stringify(settings));
        
        // Apply BGM settings immediately
        const audio = document.getElementById('background-music');
        if (audio) {
            audio.muted = !settings.bgmEnabled;
            audio.volume = settings.bgmVolume / 100;
            localStorage.setItem('isMusicMuted', !settings.bgmEnabled);
        }
    }
    
    // Volume sliders
    $('#bgmVolume').on('input', function() {
        $('#bgmVolumeValue').text($(this).val() + '%');
        saveSettings();
    });
    
    $('#sfxVolume').on('input', function() {
        $('#sfxVolumeValue').text($(this).val() + '%');
        saveSettings();
    });
    
    // All toggles and selects
    $('input[type="checkbox"], select').on('change', function() {
        saveSettings();
    });
    
    // Reset settings
    $('#resetSettings').on('click', function() {
        Swal.fire({
            title: 'üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤?',
            text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#e74c3c',
            cancelButtonColor: '#666',
            confirmButtonText: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            background: '#1e1e1e',
            color: '#fff'
        }).then((result) => {
            if (result.isConfirmed) {
                localStorage.removeItem('gameSettings');
                localStorage.removeItem('isMusicMuted');
                loadSettings();
                
                Swal.fire({
                    icon: 'success',
                    title: '‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                    timer: 1500,
                    showConfirmButton: false,
                    background: '#1e1e1e',
                    color: '#fff'
                });
            }
        });
    });
    
    // Load settings on page load
    loadSettings();
});
</script>
